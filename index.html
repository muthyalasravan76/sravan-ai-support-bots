
<!DOCTYPE html>
<html>
<head>
  <title>Sravan's AI Support</title>
  <style>
    .chat-widget { position: fixed; bottom: 20px; right: 20px; width: 320px; height: 500px; border: 1px solid #ccc; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); font-family: Arial; background: white; }
    .chat-header { background: #2563eb; color: white; padding: 12px; border-radius: 12px 12px 0 0; font-weight: bold; }
    .chat-body { height: 380px; padding: 10px; overflow-y: auto; }
    .chat-input { display: flex; border-top: 1px solid #eee; }
    #user-input { flex: 1; border: none; padding: 12px; outline: none; }
    #send-btn { background: #2563eb; color: white; border: none; padding: 0 16px; cursor: pointer; }
    .msg { margin: 8px 0; padding: 8px 12px; border-radius: 18px; max-width: 80%; }
    .user { background: #e0e7ff; align-self: flex-end; margin-left: auto; }
    .ai { background: #f3f4f6; }
  </style>
</head>
<body>

<div class="chat-widget">
  <div class="chat-header">Sravan's AI Support ðŸš€</div>
  <div class="chat-body" id="chat-body"></div>
  <div class="chat-input">
    <input id="user-input" placeholder="Type your issue..." />
    <button id="send-btn">Send</button>
  </div>
</div>

<script>
const YOUR_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzzUO94rTIT0c5qO_L8j5juBv5RySvfRK7YRYp-ECqwTvuqyDOUQlXutqdGCWiZCfCs/exec";

// OFFLINE FALLBACK REPLIES
const offlineReplies = {
  "charged twice": "Let me check your transaction history. A refund for the duplicate charge will be processed within 3 business days.",
  "app crashes": "Please try clearing app cache or reinstalling. If the issue persists, send us a screenshot at support@company.com.",
  "cancel subscription": "Go to Settings > Subscription > Cancel Plan. You'll keep access until the end of your billing cycle.",
  "refund not showing": "Refunds take 5-7 business days to reflect. Check your bank statement or PayPal. Still missing? Reply with your order ID.",
  "slow": "We're experiencing high traffic. Try again in 10 minutes or use the web version at app.company.com."
};

document.getElementById('send-btn').onclick = sendMessage;
document.getElementById('user-input').addEventListener('keypress', e => e.key === 'Enter' && sendMessage());

function addMessage(text, sender) {
  const div = document.createElement('div');
  div.className = 'msg ' + sender;
  div.textContent = text;
  document.getElementById('chat-body').appendChild(div);
  div.scrollIntoView();
}

async function sendMessage() {
  const input = document.getElementById('user-input');
  const msg = input.value.trim().toLowerCase();
  if (!msg) return;
  addMessage(input.value, 'user');
  input.value = '';

  // Try online first
  try {
    const res = await fetch(YOUR_WEB_APP_URL + '?q=' + encodeURIComponent(msg), { method: 'GET', cache: 'no-cache' });
    const data = await res.text();
    addMessage(data.trim() || "Let me escalate this to a senior agent.", 'ai');
  } catch (e) {
    // OFFLINE MODE
    let reply = "No internet. Try again when online.";
    for (const [key, value] of Object.entries(offlineReplies)) {
      if (msg.includes(key)) {
        reply = value;
        break;
      }
    }
    addMessage(reply, 'ai');
  }
}
</script>

</body>
</html>